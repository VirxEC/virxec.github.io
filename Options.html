<!DOCTYPE html>
<html lang="en-US">
<head>
    <link rel="preload" href="/Assets/Js/cookie.min.js" as="script">
    
    <link rel="preload" href="/Assets/Css/main.css" as="style">
    <link rel="preload" href="/Assets/Css/Options.css" as="style">
    <link rel="preload" href="/Assets/Js/Options.js" as="script">
    <link rel="preload" href="/Assets/Js/CPquery.js" as="script">

    <meta name="keyworks" content="HTML,CSS,JavaScript,InfiniCalc,BigCalc,Big,Infitite,Calculator,Large,Number,Not,Small,Numbers,CalcPlus,Calc,Plus,Big Number Calculator,Big # Calc,GitHub,#,Calculator Plus,Library,JS,Hyper Text Markup Language,Cascading Style Sheet,JS Library,TypeScript,TS,TS Library,TypeScript Library,Node,NPM,ModuleJS,ESNext">
    <meta name="author" content="Eric (Virx/VirxEC) Michael Veilleux: virx@virxcase.ga">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="theme-color" content="#0066ff">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="VirxEC Showcase">

    <meta name="twitter:site" content="@virxcase">
    <meta name="twitter:card" content="summery-large-card">
    <meta name="twitter:title" content="VirxEC Showcase">

    <meta name="og:image" content="/Assets/icons/site_icon.png">
    <meta name="og:site_name" content="VirxEC Showcase">
    <meta name="og:type" content="object">
    <meta name="og:title" content="VirxEC Showcase">
    <meta name="og:url" content="https://www.virxcase.ga">

    <link href="/manifest.json" rel="manifest">
    <link href="/Assets/icons/192.png" rel="icon">
    <link href="/Assets/icons/128.png" rel="apple-touch-icon">

    <meta name="description" content="Options for VirxEC Showcase">
    <meta name="twitter:description" content="Options for VirxEC Showcase">
    <meta name="og:description" content="Options for VirxEC Showcase">
    <title>Site Options</title>
</head>
<body>
    <nav>
        <div id="mt">
            <input type="checkbox">
            <span class="navdecor"></span>
            <span class="navdecor"></span>
            <span class="navdecor"></span>
            <ul>
                <li id="ic"><a href="#"><img src="/Assets/icons/096.png" alt="CalcPlus Icon"></a></li>
                <li><a href="/">Home</a></li>
                <li class="dropdown">
                    <input type="checkbox" id="calcplus">
                    <label for="calcplus">CalcPlus</label>
                    <ul class="dropdown-content">
                        <li><a href="https://www.virxcase.ga/CalcPlus/">About</a></li>
                        <li><a href="/CP-P.html">Preview</a></li>
                        <li><a href="https://github.com/VirxEC/CalcPlus">GitHub</a></li>
                        <li><a href="/CP-S.html">Source</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <input type="checkbox" id="cpquery">
                    <label for="cpquery">CPQuery</label>
                    <ul class="dropdown-content">
                        <li><a href="/CPQ-S.html">Source</a></li>
                        <li><a href="https://github.com/VirxEC/CPQuery">GitHub</a></li>
                    </ul>
                </li>
                <li><a href="/Options.html">Options</a></li>
                <li><a href="https://discord.gg/Fyu8Bdd">Discord</a></li>
            </ul>
        </div>
    </nav>
    <p id="sconsole"></p>
    <h3 id="login-prompt"><button id="login">Login/signup to save settings<br><span id="disclaimer">(You can use a fake email if you want)</span></button></h3>
    <h3 id="logout-prompt"><button id="logout">Logout</button> <button id="loadsettings">Load settings</button> <button id="savesettings">Save settings</button></h3>
    <h3>Discord Widget <button id="widget"></button></h3>
    <h3 id="channelWrap">
        Default Channel
        <select id="channel">
            <option value="629774177733181440">CalcPlus</option>
            <option value="507717342680186891">General</option>
            <option value="583376212114669578">General 2</option>
        </select>
    </h3>
    <h3>Gamer Mode <button id="gamer"></button></h3>
    <h3 id="transitionWrap">Transition time <input type="range" min="1" max="5000" id="transition"> <button id="applytrans">Apply <span id="transval"></span>ms</button></h3>
    <h3>On-Screen Console <button id="console"></button></h3>
    <h3>Reset all <button id="reset">Reset</button></h3>
    
    <link rel="stylesheet" href="/Assets/Css/main.css">
    <link rel="stylesheet" href="/Assets/Css/Options.css">
    <script src="/Assets/Js/CPquery.js"></script>
    <script src="/Assets/Js/Options.js"></script>
    <script src="/Assets/Js/cookie.min.js"></script>
    <script>
        if (Cookies.get("u") && Cookies.get("p")) {
            $("#logout-prompt").show();
            $("#login-prompt").remove();
            $("#loadsettings").click(() => {
                $("^https://api.jsonbin.io/b/5e1dbd365df640720835379c/latest").file({
                    ready: function() {
                        let data = JSON.parse(this.responseText)[Cookies.get("u")],
                            invalid = false;
                        if (data != null) {
                            data = data[Cookies.get("p")];
                            if (data != null) {
                                $("@isConsole").i(data.console);
                                $("@isWidget").i(data.widget);
                                $("@isGamer").i(data.gamer);
                                $("@channel").i(["629774177733181440", "507717342680186891", "583376212114669578"].includes(data.channel) ? data.channel : "629774177733181440");
                                $("@interval").i(data.interval);
                                location.reload();
                            } else invalid = true;
                        } else invalid = true;
                        if (invalid) {
                            Cookies.remove("u");
                            Cookies.remove("p");
                            location.replace("/login.html?invalid=true");
                        }
                    },
                    open: "GET",
                    requestHeader: {
                        "Content-type": "application/json",
                        "secret-key": "$2b$10$oMtRuPvA7L.8VNjBxDVU5.1cW0iAwTYRMEPb1kByjWjgia7yGMxOK"
                    }
                });
            });
            $("#savesettings").click(() => {
                $("^https://api.jsonbin.io/b/5e1dbd365df640720835379c/latest").file({
                    ready: function() {
                        let user = Cookies.get("u"),
                            pass = Cookies.get("p"),
                            data = JSON.parse(this.responseText),
                            invalid = false;
                            
                        if (data[user]) {
                            if (data[user][pass]) {
                                data[user][pass] = {
                                    console: $("@isConsole").i(),
                                    widget: $("@isWidget").i(),
                                    gamer: $("@isGamer").i(),
                                    channel: $("@channel").i(),
                                    interval: $("@interval").i()
                                };
                                $("^https://api.jsonbin.io/b/5e1dbd365df640720835379c").file({
                                    ready: function() {
                                        if (JSON.parse(this.responseText).success) alert("Saved your settings");
                                    },
                                    open: "PUT",
                                    requestHeader: {
                                        "Content-type": "application/json",
                                        "secret-key": "$2b$10$oMtRuPvA7L.8VNjBxDVU5.1cW0iAwTYRMEPb1kByjWjgia7yGMxOK",
                                        versioning: false
                                    },
                                    send: JSON.stringify(data)
                                });
                            } else invalid = true;
                        } else invalid = true;
                        if (invalid) {
                            Cookies.remove("u");
                            Cookies.remove("p");
                            // location.replace("/login.html?invalid=true");
                        }
                    },
                    open: "GET",
                    requestHeader: {
                        "Content-type": "application/json",
                        "secret-key": "$2b$10$oMtRuPvA7L.8VNjBxDVU5.1cW0iAwTYRMEPb1kByjWjgia7yGMxOK"
                    }
                });
            });
            $("#logout").listen("click", () => {
                Cookies.remove("u");
                Cookies.remove("p");
                location.replace("/login.html");
            });
        } else {
            $("#login-prompt").show();
            $("#logout-prompt").remove();
            $("#login").on("click", () => location.replace("/login.html"));
        }
        
        (async() => {
            let id = [
                    $("#console"),
                    $("#widget"),
                    $("#gamer")
                ],
                dex = [
                    $("@isConsole"),
                    $("@isWidget"),
                    $("@isGamer")
                ];
            $("#channel").val($("@channel").i());
            $("#transition").val($("@interval").i());
            $("#transval").txt($("@interval").i());
            id.forEach((e, i) => {
                e.txt(dex[i].i());
                e.click(() => {
                    let value = dex[i].i() == "On" ? "Off" : "On";
                    dex[i].i(value);
                    e.txt(value);
                    location.reload();
                });
            });
            if ($("@isWidget").i() == "Off") $("#channelWrap").remove();
            else {
                $("#channel").listen("change", () => {
                    $("@channel").i($("#channel").val());
                    if ($("@isWidget").i() == "On") discord.options.channel = $("@channel").i();
                });
            }
            if ($("@isGamer").i() == "Off") $("#transitionWrap").remove();
            else {
                $("#transition").listen("input", () => $("#transval").txt($("#transition").val()));
                $("#applytrans").click(() => {
                    $("@interval").i($("#transition").val());
                    location.reload();
                });
            }
            $("#reset").click(() => {
                localStorage.clear();
                location.reload();
            });
        })();
    </script>
</body>
</html>