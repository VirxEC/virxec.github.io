<DOCTYPE html>
    <html>

    <head>
        <title>Logging you in</title>
        <link rel="preload" href="/Assets/Js/md5.min.js" as="script">
        <link rel="preload" href="/Assets/Js/cookie.min.js" as="script">
        <script src="/Assets/Js/CPquery.js"></script>
        <script src="/Assets/Js/md5.min.js"></script>
        <script src="/Assets/Js/cookie.min.js"></script>
        <script>
            onerror = e => alert(e);
            (async () => {
                function get(n) {
                    let result, tmp = [];
                    location.search.substr(1).split("&").forEach(i => {
                        tmp = i.split("=");
                        if (tmp[0] == n) result = decodeURIComponent(tmp[1]);
                    });
                    return result;
                }
                if (get("e") && get("p")) {
                    let email = get("e"),
                        password = md5(get("p")),
                        signup = get("s"),
                        settings = {
                            expires: 7
                        },
                        invalid = false,
                        user_exists = false;

                    $("^https://api.jsonbin.io/b/5e1dbd365df640720835379c/latest").file({
                        ready: function () {
                            let data = JSON.parse(this.responseText);
                            if (signup === "on") {
                                if (data[email]) user_exists = true;
                                else {
                                    data[email] = {};
                                    data[email][password] = {
                                        console: $("@isConsole").i(),
                                        widget: $("@isWidget").i(),
                                        gamer: $("@isGamer").i(),
                                        channel: $("@channel").i(),
                                        interval: $("@interval").i()
                                    };
                                    $("^https://api.jsonbin.io/b/5e1dbd365df640720835379c").file({
                                        open: "PUT",
                                        requestHeader: {
                                            "Content-type": "application/json",
                                            "secret-key": "$2b$10$oMtRuPvA7L.8VNjBxDVU5.1cW0iAwTYRMEPb1kByjWjgia7yGMxOK",
                                            "versioning": "false"
                                        },
                                        send: JSON.stringify(data)
                                    });
                                }
                            } else {
                                data = data[email],
                                    invalid = false;
                                if (data) {
                                    data = data[password]
                                    if (data) {
                                        $("@isConsole").i(data.console);
                                        $("@isWidget").i(data.widget);
                                        $("@channel").i(["629774177733181440", "507717342680186891", "583376212114669578"].includes(data.channel) ? data.channel : "629774177733181440");
                                        $("@isGamer").i(data.gamer);
                                        $("@interval").i(data.interval);
                                    } else invalid = true;
                                } else invalid = true;
                            }

                            if (invalid) location.replace("/login.html?invalid=true");
                            else if (user_exists) location.replace("/login.html?user-exists=true");
                            else {
                                Cookies.set("u", email, settings);
                                Cookies.set("p", password, settings);
                                location.replace("/Options.html");
                            }
                        },
                        open: "GET",
                        requestHeader: {
                            "Content-type": "application/json",
                            "secret-key": "$2b$10$oMtRuPvA7L.8VNjBxDVU5.1cW0iAwTYRMEPb1kByjWjgia7yGMxOK"
                        }
                    });
                } else location.replace("/login.html?invalid=true");
            })();
        </script>
    </head>

    <body>
        <h4>Please wait...</h4>
        <h5><a href="/login.html">Return to the login page</a></h5>
    </body>

    </html>