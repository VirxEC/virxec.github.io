<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="description" content="Works with really large numbers">
    <title>Site Options</title>
    <script>
      if (!document.cookie && confirm("Login?")) location.replace("/login.html");
    </script>
    <link rel="preload" href="/assets/3rdParty/cookie.min.js" as="script">
	  <script src="/assets/CPquery.js"></script>
	  <script src="/assets/Options.js"></script>
  </head>
  <body>
    <nav>
      <a class="nava" href="/">Home</a>
      <a class="nava" href="/PreviewLibrary/">Preview library</a>
      <a class="nava" href="/LibrarySource/">Library Source</a>
      <a class="nava" href="/CPQuerySource/">CPQuery Source</a>
      <a class="nava" href="/CalcPlus/">About CalcPlus</a>
      <a class="nava" href="/Discord/">Offical Discord</a>
    </nav><br>
		<p id="sconsole"></p>
    <h1>Site Options</h1>
    <h3><button id="logout"><abbr title="This is a beta feature. MD5 algorithm credit: http://www.myersdaily.org/joseph/">Logout</abbr></button> <button id="loadsettings"><abbr title="This is a beta feature. MD5 algorithm credit: http://www.myersdaily.org/joseph/">Load settings</abbr></button> <button id="savesettings"><abbr title="This is a beta feature. MD5 algorithm credit: http://www.myersdaily.org/joseph/">Save settings</abbr></button></h3>
    <h3>Dark Mode <button id="dark"></button></h3>
    <h3><abbr title="Credit: Highlight JS (hightlightjs.org)">Syntax Highlighting</abbr> <button id="syntax"></button></h3>
		<h3><abbr title="Credit: WidgetBot (widgetbot.io)">Discord Widget</abbr> <button id="widget"></button></h3>
		<h3><abbr title="Requires Discord Widget to work">Default Channel</abbr>
			<select id="channel">
				<option value="629774177733181440">CalcPlus</option>
				<option value="507717342680186891">General</option>
				<option value="583376212114669578">General 2</option>
			</select>
		</h3>
		<h3>Gamer Mode <button id="gamer"></button></h3>
		<h3><abbr title="Requires Gamer Mode to work">Transition time</abbr> <input type="range" min="1" max="5000" id="transition"> <button id="applytrans">Apply <span id="transval"></span>ms</button></h3>
    <h3>On-Screen Console <button id="console"></button></h3>
    <h3>Reset all <button id="reset">Reset</button></h3>
    <script src="/assets/3rdParty/cookie.min.js"></script>
    <script>
      (async ()=>{
        $("#loadsettings").listen("click", ()=>{
          let req = new $("^https://api.jsonbin.io/b/5e1dbd365df640720835379c/latest").file;
          req.ready(function() {
            let data = JSON.parse(this.responseText)[Cookies.get("u")],
              invalid = false;
            if (data != null) {
              data = data[Cookies.get("p")];
              if (data != null) {
                $("@isDark").i(data.dark);
                $("@isConsole").i(data.console);
                $("@isWidget").i(data.widget);
                $("@isGamer").i(data.gamer);
                $("@isSyntax").i(data.syntax);
                ["629774177733181440", "507717342680186891", "583376212114669578"].includes(data.channel) ? $("@channel").i("629774177733181440") : $("@channel").i(data.channel);
                $("@interval").i(data.interval);
                location.reload();
              } else invalid = true;
            } else invalid = true;
            if (invalid) {
              Cookies.remove("u");
              Cookies.remove("p");
              location.replace("/login.html?invalid=true");
            }
          });
          req.open("GET");
          req.i("setRequestHeader", "secret-key", "$2b$10$oMtRuPvA7L.8VNjBxDVU5.1cW0iAwTYRMEPb1kByjWjgia7yGMxOK");
          req.send();
        });
        $("#savesettings").listen("click", ()=>{
          let req = new $("^https://api.jsonbin.io/b/5e1dbd365df640720835379c/latest").file;
          req.ready(function() {
            let user = Cookies.get("u"),
              pass = Cookies.get("p"),
              data = JSON.parse(this.responseText),
              invalid = false;
            if (data[user]) {
              if (data[user][pass]) {
                data[user][pass] = {
                  dark: $("@isDark").i(),
                  console: $("@isConsole").i(),
                  widget: $("@isWidget").i(),
                  gamer: $("@isGamer").i(),
                  syntax: $("@isSyntax").i(),
                  channel: $("@channel").i(),
                  interval: $("@interval").i()
                };
                let save = new $("^https://api.jsonbin.io/b/5e1dbd365df640720835379c").file;
                save.ready(function() {
                  let response = JSON.parse(this.responseText);
                  if (response.success) alert("Saved your settings");
                });
                save.open("PUT");
                save.i("setRequestHeader", "Content-type", "application/json");
                save.i("setRequestHeader", "secret-key", "$2b$10$oMtRuPvA7L.8VNjBxDVU5.1cW0iAwTYRMEPb1kByjWjgia7yGMxOK");
                save.i("setRequestHeader", "versioning", "false");
                save.send(JSON.stringify(data));
              } else invalid = true;
            } else invalid = true;
            if (invalid) {
              Cookies.remove("u");
              Cookies.remove("p");
              location.replace("/login.html?invalid=true");
            }
          });
          req.open("GET");
          req.i("setRequestHeader", "secret-key", "$2b$10$oMtRuPvA7L.8VNjBxDVU5.1cW0iAwTYRMEPb1kByjWjgia7yGMxOK");
          req.send();
        });
        $("#logout").listen("click", ()=>{
          Cookies.remove("u");
          Cookies.remove("p");
          location.replace("/login.html");
        })
      })();
      (async ()=>{
        let id = [
            $("#dark"),
            $("#console"),
            $("#widget"),
            $("#gamer"),
            $("#syntax")
          ],
          dex = [
            $("@isDark"),
            $("@isConsole"),
            $("@isWidget"),
            $("@isGamer"),
            $("@isSyntax")
          ];
        $("#channel").tag("value",$("@channel").i());
        $("#transition").tag("value", $("@interval").i());
        $("#transval").txt($("@interval").i());
        id.forEach((e,i)=>{
          e.txt(dex[i].i());
          e.listen("click", ()=>{
            let value = dex[i].i()=="On"?"Off":"On";
            dex[i].i(value);
            e.txt(value);
            location.reload();
          });
        });
        $("#transition").listen("input", ()=>$("#transval").txt($("#transition").tag("value")));
        $("#applytrans").listen("click", ()=>{
          $("@interval").i($("#transition").tag("value"));
          location.reload();
        });
        $("#channel").listen("change", ()=>{
          $("@channel").i($("#channel").tag("value"));
          if ($("@isWidget").i() == "On") discord.options.channel = $("@channel").i();
        });
        $("#reset").listen("click", ()=>{
          localStorage.clear();
          location.reload();
        });
      })();
    </script>
  </body>
</html>
